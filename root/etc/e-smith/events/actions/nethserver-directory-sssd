#!/bin/bash

# Check if SSSD is already configured for OpenLDAP
suffix=$(perl -mNethServer::Directory -e "print NethServer::Directory::getDomainSuffix()")
authconfig --enablesssdauth --enablemkhomedir --test | grep -q $suffix

if [ $? -gt 0 ]; then # first install
    authconfig --enablesssdauth --enablemkhomedir --update
    exec /sbin/e-smith/signal-event nethserver-sssd-save
fi
